{"ast":null,"code":"import _objectSpread from\"D:/Workspace/project-calc-resource/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Grid,TextField,Typography,Button,Paper,Box,Alert}from'@mui/material';import{calculateTPCC,calculatePeakTPS,calculateServerResources,BASELINE_SINGLE_CORE}from'../../services/performanceCalculator';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const STORAGE_KEY='tpccCalculatorData';export default function TPCCCalculator(_ref){let{onResultChange}=_ref;const[inputs,setInputs]=useState(()=>{// 从localStorage读取初始数据\nconst savedData=localStorage.getItem(STORAGE_KEY);return savedData?JSON.parse(savedData):{warehouseCount:'',tpmC:'',systemRedundancy:'',nonDbResourcePercentage:''};});const handleInputChange=field=>event=>{const value=event.target.value;setInputs(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));};useEffect(()=>{// 保存到localStorage\nlocalStorage.setItem(STORAGE_KEY,JSON.stringify(inputs));// 计算结果\nconst{warehouseCount,tpmC,systemRedundancy,nonDbResourcePercentage}=inputs;const W=parseFloat(warehouseCount)||0;const T=parseFloat(tpmC)||0;const R=parseFloat(systemRedundancy)||0;const N=parseFloat(nonDbResourcePercentage)||0;let result=0;let explanation='';if(W>0&&T>0){const denominator=1-R/100-N/100;if(denominator>0){result=W*T/denominator;explanation=\"\\n          \\u8BA1\\u7B97\\u8FC7\\u7A0B\\u8BF4\\u660E\\uFF1A\\n          1. \\u4ED3\\u5E93\\u6570\\u91CF (W) = \".concat(W,\"\\n          2. \\u6BCF\\u5206\\u949F\\u4E8B\\u52A1\\u6570 (T) = \").concat(T,\"\\n          3. \\u7CFB\\u7EDF\\u5197\\u4F59\\u7387 (R) = \").concat(R,\"%\\n          4. \\u975E\\u6570\\u636E\\u5E93\\u8D44\\u6E90\\u5360\\u6BD4 (N) = \").concat(N,\"%\\n          5. TPC-C \\u5F97\\u5206 = (W \\xD7 T) / (1 - R% - N%)\\n          6. \\u6700\\u7EC8\\u7ED3\\u679C = (\").concat(W,\" \\xD7 \").concat(T,\") / (1 - \").concat(R,\"/100 - \").concat(N,\"/100) = \").concat(result.toFixed(2),\"\\n        \");}else{explanation='错误：系统冗余率与非数据库资源占比之和不能大于或等于100%';}}onResultChange({coreCount:Math.ceil(result),explanation});},[inputs,onResultChange]);return/*#__PURE__*/_jsxs(Box,{component:Paper,p:3,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"TPC-C \\u8BA1\\u7B97\\u5668\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"\\u4ED3\\u5E93\\u6570\\u91CF\",type:\"number\",value:inputs.warehouseCount,onChange:handleInputChange('warehouseCount'),helperText:\"\\u8F93\\u5165\\u7CFB\\u7EDF\\u4E2D\\u7684\\u4ED3\\u5E93\\u6570\\u91CF\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"\\u6BCF\\u5206\\u949F\\u4E8B\\u52A1\\u6570(tpmC)\",type:\"number\",value:inputs.tpmC,onChange:handleInputChange('tpmC'),helperText:\"\\u8F93\\u5165\\u6BCF\\u5206\\u949F\\u7684\\u4E8B\\u52A1\\u5904\\u7406\\u6570\\u91CF\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"\\u7CFB\\u7EDF\\u5197\\u4F59\\u7387(%)\",type:\"number\",value:inputs.systemRedundancy,onChange:handleInputChange('systemRedundancy'),helperText:\"\\u8F93\\u5165\\u7CFB\\u7EDF\\u9884\\u7559\\u7684\\u5197\\u4F59\\u7387\\u767E\\u5206\\u6BD4\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"\\u975E\\u6570\\u636E\\u5E93\\u8D44\\u6E90\\u5360\\u6BD4(%)\",type:\"number\",value:inputs.nonDbResourcePercentage,onChange:handleInputChange('nonDbResourcePercentage'),helperText:\"\\u8F93\\u5165\\u975E\\u6570\\u636E\\u5E93\\u5360\\u7528\\u7684\\u7CFB\\u7EDF\\u8D44\\u6E90\\u767E\\u5206\\u6BD4\"})})]}),parseFloat(inputs.systemRedundancy)+parseFloat(inputs.nonDbResourcePercentage)>=100&&/*#__PURE__*/_jsx(Box,{mt:2,children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:\"\\u7CFB\\u7EDF\\u5197\\u4F59\\u7387\\u4E0E\\u975E\\u6570\\u636E\\u5E93\\u8D44\\u6E90\\u5360\\u6BD4\\u4E4B\\u548C\\u4E0D\\u80FD\\u5927\\u4E8E\\u6216\\u7B49\\u4E8E100%\"})})]});}","map":{"version":3,"names":["React","useState","useEffect","Grid","TextField","Typography","Button","Paper","Box","Alert","calculateTPCC","calculatePeakTPS","calculateServerResources","BASELINE_SINGLE_CORE","jsx","_jsx","jsxs","_jsxs","STORAGE_KEY","TPCCCalculator","_ref","onResultChange","inputs","setInputs","savedData","localStorage","getItem","JSON","parse","warehouseCount","tpmC","systemRedundancy","nonDbResourcePercentage","handleInputChange","field","event","value","target","prev","_objectSpread","setItem","stringify","W","parseFloat","T","R","N","result","explanation","denominator","concat","toFixed","coreCount","Math","ceil","component","p","children","variant","gutterBottom","container","spacing","item","xs","sm","fullWidth","label","type","onChange","helperText","mt","severity"],"sources":["D:/Workspace/project-calc-resource/src/components/calculators/TPCCCalculator.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Grid,\r\n  TextField,\r\n  Typography,\r\n  Button,\r\n  Paper,\r\n  Box,\r\n  Alert\r\n} from '@mui/material';\r\nimport {\r\n  calculateTPCC,\r\n  calculatePeakTPS,\r\n  calculateServerResources,\r\n  BASELINE_SINGLE_CORE\r\n} from '../../services/performanceCalculator';\r\n\r\nconst STORAGE_KEY = 'tpccCalculatorData';\r\n\r\nexport default function TPCCCalculator({ onResultChange }) {\r\n  const [inputs, setInputs] = useState(() => {\r\n    // 从localStorage读取初始数据\r\n    const savedData = localStorage.getItem(STORAGE_KEY);\r\n    return savedData ? JSON.parse(savedData) : {\r\n      warehouseCount: '',\r\n      tpmC: '',\r\n      systemRedundancy: '',\r\n      nonDbResourcePercentage: ''\r\n    };\r\n  });\r\n\r\n  const handleInputChange = (field) => (event) => {\r\n    const value = event.target.value;\r\n    setInputs(prev => ({\r\n      ...prev,\r\n      [field]: value\r\n    }));\r\n  };\r\n\r\n  useEffect(() => {\r\n    // 保存到localStorage\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(inputs));\r\n\r\n    // 计算结果\r\n    const {\r\n      warehouseCount,\r\n      tpmC,\r\n      systemRedundancy,\r\n      nonDbResourcePercentage\r\n    } = inputs;\r\n\r\n    const W = parseFloat(warehouseCount) || 0;\r\n    const T = parseFloat(tpmC) || 0;\r\n    const R = parseFloat(systemRedundancy) || 0;\r\n    const N = parseFloat(nonDbResourcePercentage) || 0;\r\n\r\n    let result = 0;\r\n    let explanation = '';\r\n\r\n    if (W > 0 && T > 0) {\r\n      const denominator = 1 - (R / 100) - (N / 100);\r\n      if (denominator > 0) {\r\n        result = (W * T) / denominator;\r\n        explanation = `\r\n          计算过程说明：\r\n          1. 仓库数量 (W) = ${W}\r\n          2. 每分钟事务数 (T) = ${T}\r\n          3. 系统冗余率 (R) = ${R}%\r\n          4. 非数据库资源占比 (N) = ${N}%\r\n          5. TPC-C 得分 = (W × T) / (1 - R% - N%)\r\n          6. 最终结果 = (${W} × ${T}) / (1 - ${R}/100 - ${N}/100) = ${result.toFixed(2)}\r\n        `;\r\n      } else {\r\n        explanation = '错误：系统冗余率与非数据库资源占比之和不能大于或等于100%';\r\n      }\r\n    }\r\n\r\n    onResultChange({\r\n      coreCount: Math.ceil(result),\r\n      explanation\r\n    });\r\n  }, [inputs, onResultChange]);\r\n\r\n  return (\r\n    <Box component={Paper} p={3}>\r\n      <Typography variant=\"h6\" gutterBottom>\r\n        TPC-C 计算器\r\n      </Typography>\r\n      \r\n      <Grid container spacing={3}>\r\n        <Grid item xs={12} sm={6}>\r\n          <TextField\r\n            fullWidth\r\n            label=\"仓库数量\"\r\n            type=\"number\"\r\n            value={inputs.warehouseCount}\r\n            onChange={handleInputChange('warehouseCount')}\r\n            helperText=\"输入系统中的仓库数量\"\r\n          />\r\n        </Grid>\r\n        \r\n        <Grid item xs={12} sm={6}>\r\n          <TextField\r\n            fullWidth\r\n            label=\"每分钟事务数(tpmC)\"\r\n            type=\"number\"\r\n            value={inputs.tpmC}\r\n            onChange={handleInputChange('tpmC')}\r\n            helperText=\"输入每分钟的事务处理数量\"\r\n          />\r\n        </Grid>\r\n        \r\n        <Grid item xs={12} sm={6}>\r\n          <TextField\r\n            fullWidth\r\n            label=\"系统冗余率(%)\"\r\n            type=\"number\"\r\n            value={inputs.systemRedundancy}\r\n            onChange={handleInputChange('systemRedundancy')}\r\n            helperText=\"输入系统预留的冗余率百分比\"\r\n          />\r\n        </Grid>\r\n        \r\n        <Grid item xs={12} sm={6}>\r\n          <TextField\r\n            fullWidth\r\n            label=\"非数据库资源占比(%)\"\r\n            type=\"number\"\r\n            value={inputs.nonDbResourcePercentage}\r\n            onChange={handleInputChange('nonDbResourcePercentage')}\r\n            helperText=\"输入非数据库占用的系统资源百分比\"\r\n          />\r\n        </Grid>\r\n      </Grid>\r\n\r\n      {parseFloat(inputs.systemRedundancy) + parseFloat(inputs.nonDbResourcePercentage) >= 100 && (\r\n        <Box mt={2}>\r\n          <Alert severity=\"error\">\r\n            系统冗余率与非数据库资源占比之和不能大于或等于100%\r\n          </Alert>\r\n        </Box>\r\n      )}\r\n    </Box>\r\n  );\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}